# seller-api-postgres: Static KV credentials (NOT dynamic database engine)
# Fixed 2026-02-15: Switched from vault-backend-database (dynamic, TTL 15min)
# to vault-backend (KV static) to eliminate credential rotation loop
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: seller-api-postgres
  namespace: keybuzz-seller-dev
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault-backend
  target:
    name: seller-api-postgres
    creationPolicy: Owner
    deletionPolicy: Retain
  data:
    - secretKey: PGHOST
      remoteRef:
        key: secret/data/keybuzz/dev/seller-api-postgres
        property: PGHOST
    - secretKey: PGPORT
      remoteRef:
        key: secret/data/keybuzz/dev/seller-api-postgres
        property: PGPORT
    - secretKey: PGDATABASE
      remoteRef:
        key: secret/data/keybuzz/dev/seller-api-postgres
        property: PGDATABASE
    - secretKey: PGUSER
      remoteRef:
        key: secret/data/keybuzz/dev/seller-api-postgres
        property: PGUSER
    - secretKey: PGPASSWORD
      remoteRef:
        key: secret/data/keybuzz/dev/seller-api-postgres
        property: PGPASSWORD
