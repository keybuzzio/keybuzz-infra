# PH16.1-SPACE-SYNC-ECOMLG-01 — Rapport

**Date** : 2026-01-08  
**Statut** : ✅ TERMINÉ

---

## Résumé

Création du tenant "eComLG" (id: `ecomlg-001`) et alignement entre les deux bases de données (keybuzz + keybuzz_backend).

---

## 1. Tenant Créé

### Base `keybuzz` (API produit)

```sql
INSERT INTO tenants (id, name, plan, status)
VALUES ('ecomlg-001', 'eComLG', 'pro', 'active');

-- User mapping
INSERT INTO user_tenants (user_id, tenant_id, role)
VALUES ('<ludo-user-id>', 'ecomlg-001', 'owner');

-- Set as current
UPDATE user_preferences
SET current_tenant_id = 'ecomlg-001'
WHERE user_id = '<ludo-user-id>';
```

### Base `keybuzz_backend` (marketplace)

```sql
INSERT INTO "Tenant" (id, slug, name, plan, status)
VALUES ('ecomlg-001', 'ecomlg', 'eComLG', 'PRO', 'ACTIVE');
```

---

## 2. Fix Noms Tenants

L'API retournait des noms hardcodés. Corrigé pour utiliser les vrais noms depuis la DB.

**Avant** :
```typescript
name: t.tenant_id === 'kbz-001' ? 'KeyBuzz Demo' : 'KeyBuzz Test'
```

**Après** :
```typescript
name: t.tenant_name || t.tenant_id
```

Query modifiée pour inclure `t.name as tenant_name`.

---

## 3. Preuves E2E

### tenant-context/me

```json
{
  "user": {"email": "ludo.gonthier@gmail.com"},
  "tenants": [
    {"id": "kbz-001", "name": "Acme Corporation", "role": "owner"},
    {"id": "kbz-002", "name": "TechStart Inc", "role": "admin"},
    {"id": "ecomlg-001", "name": "eComLG", "role": "owner"}
  ],
  "currentTenantId": "ecomlg-001"
}
```

### Amazon status pour ecomlg-001

```json
{
  "connected": false,
  "status": "DISCONNECTED",
  "displayName": null
}
```

✅ Status DISCONNECTED attendu (pas de connexion Amazon pour ce nouveau tenant)

---

## 4. Fichiers Modifiés

| Fichier | Description |
|---------|-------------|
| `keybuzz-api/src/modules/auth/tenant-context-routes.ts` | Query avec tenant_name + mapping dynamique |

---

## 5. Versions Déployées

| Composant | Version |
|-----------|---------|
| keybuzz-api | **v0.1.73-dev** |
| keybuzz-client | v0.2.43-dev (inchangé) |
| keybuzz-backend | v1.0.2-dev (inchangé) |

---

## 6. Commits

| Repo | Commit | Message |
|------|--------|---------|
| keybuzz-api | `64c348c` | fix: use real tenant names from DB |

---

## 7. État Final

| Élément | Statut |
|---------|--------|
| ecomlg-001 dans keybuzz | ✅ |
| ecomlg-001 dans keybuzz_backend | ✅ |
| Mapping user ludo.gonthier@gmail.com | ✅ owner |
| currentTenantId = ecomlg-001 | ✅ |
| Noms tenants dynamiques | ✅ |
| /channels avec bon tenantId | ✅ |

---

**Fin du rapport PH16.1-SPACE-SYNC-ECOMLG-01**
