# PH28.3 - PROD UI Restore (signup + env label)

**Date:** 2026-02-01  
**Status:** ✅ COMPLET

---

## 1. RÉSUMÉ EXÉCUTIF

### Changements effectués

| Aspect | Avant | Après |
|--------|-------|-------|
| Login page | Pas de lien signup | ✅ "Pas encore de compte? Créer un compte" |
| Env label | "Environnement de développement" affiché | ✅ Label masqué (PROD) |
| /signup | ✅ Existait déjà | ✅ Accessible via lien |

---

## 2. PREFLIGHT (état initial)

### Image PROD avant modification

```
ghcr.io/keybuzzio/keybuzz-client:prod-2026-02-01
Version: 0.5.10-channels-polish
```

### Constat initial

| Check | Résultat |
|-------|----------|
| /signup accessible | ✅ HTTP 200 |
| Lien signup sur /login | ❌ Absent |
| Label "Environnement de développement" | ❌ Présent |

---

## 3. MODIFICATIONS APPORTÉES

### 3.1 Login page (`app/login/page.tsx`)

**Ajout du lien signup:**
```tsx
<p className="mt-6 text-sm text-center text-gray-500 dark:text-gray-400">
  {t('common.auth.no_account') || "Pas encore de compte ?"}{' '}
  <a href="/signup" className="text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 font-medium">
    {t('common.auth.create_account') || "Créer un compte"}
  </a>
</p>
```

**Condition pour env label:**
```tsx
{process.env.NEXT_PUBLIC_APP_ENV === 'development' && (
  <p className="mt-4 text-xs text-center text-amber-500">
    {t('common.auth.dev_notice') || 'Environnement de développement'}
  </p>
)}
```

### 3.2 Traductions (`src/lib/i18n/I18nProvider.tsx`)

Ajout dans `FR_TRANSLATIONS_INLINE.common.auth`:
```javascript
no_account: "Pas encore de compte ?",
create_account: "Créer un compte",
```

### 3.3 Traductions (`public/locales/fr/common.json`)

```json
"auth": {
  "no_account": "Pas encore de compte ?",
  "create_account": "Créer un compte",
  ...
}
```

---

## 4. IMAGE DÉPLOYÉE

| Propriété | Valeur |
|-----------|--------|
| Image | `ghcr.io/keybuzzio/keybuzz-client:prod-restore-2026-02-01d` |
| Digest | `sha256:1e4779aee5b84b0187820728768dadadd4d9aa4052e9696dc6045e40b2a6dd5b` |
| Build args | `NEXT_PUBLIC_API_URL=https://api.keybuzz.io` |
| Build args | `NEXT_PUBLIC_APP_ENV=production` |

---

## 5. VALIDATION E2E

### 5.1 Page /login

| Vérification | Résultat |
|--------------|----------|
| "Connexion" heading | ✅ |
| Formulaire email | ✅ |
| Google OAuth button | ✅ |
| Microsoft OAuth button | ✅ |
| "Pas encore de compte?" text | ✅ |
| "Créer un compte" link | ✅ → /signup |
| Label "Environnement de développement" | ✅ Masqué |

### 5.2 Page /signup

| Vérification | Résultat |
|--------------|----------|
| "Inscription" heading | ✅ |
| Formulaire email | ✅ |
| Google/Microsoft buttons | ✅ |
| "Déjà un compte? Se connecter" link | ✅ → /login |
| Onboarding après signup | ✅ Accessible |

### 5.3 Network requests

| Destination | Présence |
|-------------|----------|
| `client.keybuzz.io` | ✅ |
| `api.keybuzz.io` | ✅ |
| `*-dev.keybuzz.io` | ❌ Aucun |

---

## 6. CONFIRMATION DB PROD INCHANGÉE

```sql
SELECT COUNT(*) FROM users;      -- 1 (test@keybuzz.io)
SELECT COUNT(*) FROM tenants;    -- 0
SELECT COUNT(*) FROM conversations; -- 0
```

La base PROD reste isolée de DEV.

---

## 7. COMMITS GIT

| Commit | Description |
|--------|-------------|
| `06f1b6e` | feat(PH28.3): Update client PROD to prod-restore-2026-02-01c |
| `af638f0` | feat(PH28.3): Final client PROD with signup link and translations |

---

## 8. ROLLBACK

En cas de problème:

```bash
# Revenir à l'image précédente
kubectl set image deployment/keybuzz-client \
  keybuzz-client=ghcr.io/keybuzzio/keybuzz-client:prod-2026-02-01 \
  -n keybuzz-client-prod

kubectl rollout status deployment/keybuzz-client -n keybuzz-client-prod
```

---

## 9. CHECKLIST FINALE

- [x] /login: Lien "Créer un compte" visible
- [x] /login: Label "dev" masqué en PROD
- [x] /signup: Accessible et fonctionnel
- [x] Onboarding: Accessible après signup
- [x] Network: Tous appels vers PROD
- [x] DB PROD: Inchangée

---

**PH28.3 - PROD UI Restore Complete**
