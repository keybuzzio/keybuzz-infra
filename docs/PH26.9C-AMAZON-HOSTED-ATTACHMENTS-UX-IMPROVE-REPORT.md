# PH26.9C - Amazon "Ã‰lÃ©ment photo" : Affichage mÃªme avec PJ existantes

**Date:** 2026-02-01  
**Status:** âœ… DÃ‰PLOYÃ‰ EN DEV

---

## 1. RÃ‰SUMÃ‰

AmÃ©lioration de PH26.9B : le bloc d'avertissement Amazon s'affiche maintenant **mÃªme si des piÃ¨ces jointes existent**, car Amazon peut ne pas transmettre toutes les photos.

---

## 2. CHANGEMENT DE COMPORTEMENT

### AVANT (PH26.9B)
```
Condition: msg.amazonAttachmentHint && msg.attachments.length === 0
```
Le bloc n'apparaissait que si **aucune** PJ n'Ã©tait prÃ©sente.

### APRÃˆS (PH26.9C)
```
Condition: msg.amazonAttachmentHint
```
Le bloc apparaÃ®t **toujours** quand le pattern "Ã‰lÃ©ment photo" est dÃ©tectÃ©.

---

## 3. TEXTE CONDITIONNEL

### Si `attachments.length === 0`

| Ã‰lÃ©ment | Valeur |
|---------|--------|
| **Titre** | ğŸ“· PiÃ¨ce jointe Amazon non transmise |
| **Texte** | Amazon a signalÃ© une photo, mais le fichier n'a pas Ã©tÃ© transmis dans l'email de notification. |

### Si `attachments.length > 0`

| Ã‰lÃ©ment | Valeur |
|---------|--------|
| **Titre** | ğŸ“· Certaines piÃ¨ces jointes peuvent manquer |
| **Texte** | Amazon a signalÃ© une photo. Certaines piÃ¨ces jointes peuvent ne pas Ãªtre transmises via email. Si nÃ©cessaire, ajoutez-les manuellement. |

---

## 4. CODE MODIFIÃ‰

**Fichier:** `keybuzz-client/app/inbox/InboxTripane.tsx`

```tsx
{/* PH26.9B/9C: Amazon hosted attachment hint - shown even with some attachments */}
{msg.amazonAttachmentHint && (
  <div className="mt-3 pt-3 border-t border-gray-200 dark:border-gray-600">
    <div className="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded-lg p-4">
      <div className="flex items-start gap-3">
        <Camera className="h-6 w-6 text-amber-500 dark:text-amber-400 flex-shrink-0 mt-0.5" />
        <div className="flex-1">
          <h4 className="font-semibold text-amber-800 dark:text-amber-200 text-sm">
            {(!msg.attachments || msg.attachments.length === 0) 
              ? "ğŸ“· PiÃ¨ce jointe Amazon non transmise"
              : "ğŸ“· Certaines piÃ¨ces jointes peuvent manquer"}
          </h4>
          <p className="text-amber-700 dark:text-amber-300 text-xs mt-1 leading-relaxed">
            {(!msg.attachments || msg.attachments.length === 0)
              ? "Amazon a signalÃ© une photo, mais le fichier n'a pas Ã©tÃ© transmis..."
              : "Amazon a signalÃ© une photo. Certaines piÃ¨ces jointes peuvent ne pas Ãªtre transmises..."}
          </p>
          {/* CTA buttons unchanged */}
        </div>
      </div>
    </div>
  </div>
)}
```

---

## 5. TESTS E2E

### Conversation Bariere (ecomlg-001)

| Test | RÃ©sultat attendu |
|------|------------------|
| Message "Ã‰lÃ©ment photo" avec 1 PJ | Bloc affichÃ© avec "Certaines piÃ¨ces jointes peuvent manquer" âœ… |
| Message "Ã‰lÃ©ment photo" sans PJ | Bloc affichÃ© avec "PiÃ¨ce jointe non transmise" âœ… |
| Bouton "Ajouter fichier" | Ouvre sÃ©lecteur fichier âœ… |

### Non-rÃ©gression

| Test | RÃ©sultat attendu |
|------|------------------|
| Message normal avec PJ, sans pattern | Pas de bloc âœ… |
| Message normal sans PJ, sans pattern | Pas de bloc âœ… |

---

## 6. DÃ‰PLOIEMENT

### Image

| Service | Tag | Digest |
|---------|-----|--------|
| Client | `v0.5.30-amazon-hint-improve` | `sha256:ba1dba316fb6...` |

### Manifests

- `k8s/keybuzz-client-dev/deployment.yaml` - Mis Ã  jour

---

## 7. CAPTURES

### Avant (PH26.9B)
- Message "Ã‰lÃ©ment photo" + 1 PJ â†’ Pas de bloc affichÃ©

### AprÃ¨s (PH26.9C)
- Message "Ã‰lÃ©ment photo" + 1 PJ â†’ Bloc affichÃ© avec texte conditionnel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“· Certaines piÃ¨ces jointes peuvent manquer                     â”‚
â”‚                                                                 â”‚
â”‚ Amazon a signalÃ© une photo. Certaines piÃ¨ces jointes peuvent   â”‚
â”‚ ne pas Ãªtre transmises via email. Si nÃ©cessaire, ajoutez-les    â”‚
â”‚ manuellement.                                                   â”‚
â”‚                                                                 â”‚
â”‚ [ğŸ”— Ouvrir dans Seller Central]  [ğŸ“¤ Ajouter le fichier...]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. FLOW LOGIQUE

```
Message reÃ§u
    â”‚
    â–¼
Body contient "Ã‰lÃ©ment photo" ?
    â”‚
    â”œâ”€â”€ Non â†’ Pas de bloc
    â”‚
    â””â”€â”€ Oui â†’ amazonAttachmentHint = true
              â”‚
              â–¼
        attachments.length > 0 ?
              â”‚
              â”œâ”€â”€ Non â†’ "PiÃ¨ce jointe Amazon non transmise"
              â”‚
              â””â”€â”€ Oui â†’ "Certaines piÃ¨ces jointes peuvent manquer"
```

---

**Rapport gÃ©nÃ©rÃ© - PH26.9C Amazon Hosted Attachments UX Improvement**
